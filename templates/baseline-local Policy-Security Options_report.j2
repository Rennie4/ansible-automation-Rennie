<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; background-color: #f0f2f5; color: #333; }
        .report-container { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 1300px; margin: auto; }
        .header { border-bottom: 4px solid #0056b3; padding-bottom: 20px; margin-bottom: 35px; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; color: #1a2b3c; font-size: 2.2em; }
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 40px; }
        .card { padding: 30px; border-radius: 12px; border: 1px solid #e1e4e8; border-top: 6px solid #007bff; text-align: center; }
        .card h3 { margin: 0; color: #6a737d; text-transform: uppercase; font-size: 0.8em; letter-spacing: 1.5px; }
        .card .value { font-size: 3em; font-weight: 800; margin-top: 10px; color: #1a2b3c; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; border: 1px solid #e1e4e8; border-radius: 8px; overflow: hidden; }
        th { background-color: #f8f9fa; padding: 18px; text-align: left; font-weight: 700; border-bottom: 2px solid #e1e4e8; color: #444; }
        td { padding: 14px 18px; border-bottom: 1px solid #f0f0f0; font-size: 0.95em; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #f8fbff; }
        .status-Enabled { color: #28a745; font-weight: 700; }
        .status-Disabled { color: #dc3545; font-weight: 700; }
        .status-Not-Defined { color: #9da5b1; font-style: italic; }
        .status-Require { color: #fd7e14; font-weight: 700; }
    </style>
</head>
<body>
    <div class="report-container">
        <div class="header">
            <h1>Windows Server 2025 Audit</h1>
            <span style="color: #6a737d; font-weight: 600;">{{ ansible_date_time.date }}</span>
        </div>
        <div class="summary-grid">
            <div class="card">
                <h3>TARGET SETTINGS</h3>
                <div class="value">{{ security_options_map.keys() | length }}</div>
            </div>
            <div class="card" style="border-top-color: #28a745;">
                <h3>AUDITED COUNT</h3>
                <div class="value">{{ scan_output.stdout_lines | length }}</div>
            </div>
            <div class="card" style="border-top-color: #17a2b8;">
                <h3>HOSTNAME</h3>
                <div class="value" style="font-size: 1.8em; padding-top: 15px;">{{ inventory_hostname }}</div>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th width="70%">Security Policy Setting</th>
                    <th>Current State</th>
                </tr>
            </thead>
            <tbody>
                {% for line in scan_output.stdout_lines %}
                    {% set parts = line.split('|') %}
                    {% set val = parts[1] if parts | length > 1 else 'Not Defined' %}
                    <tr>
                        <td>{{ parts[0] }}</td>
                        <td class="status-{{ val.split(' ')[0].replace('-', '') if val != 'Not Defined' else 'Not-Defined' }}">
                            {{ val }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
