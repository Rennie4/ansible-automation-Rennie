
    # ---------- Build sizes list from CSV OR single size (+ default count=1) ----------
    - name: Decide if CSV provided
      set_fact:
        use_csv: "{{ (sizes_csv | trim | length) > 0 }}"

    - name: Compute count (default to 1 if single_count omitted/blank)
      set_fact:
        count_val: "{{ (single_count | default(1)) | int }}"

    - name: Build sizes_int_list
      set_fact:
        sizes_int_list: >-
          {{ use_csv
             | ternary(
                 sizes_csv | trim | split(',') | map('trim') | map('int') | list,
                 ([ single_size | int ] * count_val)
               )
          }}

    - name: Validate sizes_int_list
      assert:
        that:
          - sizes_int_list | length > 0
          - (sizes_int_list | min) > 0
        fail_msg: >-
          Provide either 'target_volume_sizes_csv' (e.g., 20,30,50)
          OR 'target_vol_size' (e.g., 30) [with optional 'target_volume_count'; default is 1].
