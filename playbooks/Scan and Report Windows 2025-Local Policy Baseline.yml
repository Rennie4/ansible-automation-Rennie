---
- name: Scan and Report Windows 2025 Local Policy Baseline
  hosts: windows_server_2025
  gather_facts: no
  tasks:
    - name: Create transient directory for policy processing
      ansible.windows.win_file:
        path: C:\temp\baseline_audit
        state: directory

    - name: Deploy default baseline template
      ansible.builtin.template:
        src: windows_2025_defaults.inf.j2
        dest: C:\temp\baseline_audit\defaults.inf

    - name: Apply defaults using secedit
      ansible.windows.win_shell: |
        # Use /configure to enforce the defaults from the .inf file
        secedit /configure /db C:\temp\baseline_audit\temp.sdb /cfg C:\temp\baseline_audit\defaults.inf /areas USER_RIGHTS
      register: secedit_result

    - name: Cleanup temporary audit files
      ansible.windows.win_file:
        path: C:\temp\baseline_audit
        state: absent

    - name: Execution Summary
      debug:
        msg: "The Windows 2025 host has been reset to its out-of-the-box defaults as per the audit report."
